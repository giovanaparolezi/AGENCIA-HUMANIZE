-- 1. Nichos
create table nichos (
    id uuid primary key default gen_random_uuid(),
    nome text not null unique
);

-- 2. Serviços
create table servicos (
    id uuid primary key default gen_random_uuid(),
    nome text not null unique
);

-- 3. Clientes
create table clientes (
    id uuid primary key default gen_random_uuid(),
    nome text not null,
    email text not null unique,
    empresa text,
    celular text,
    nicho_id uuid references nichos(id) on delete set null,
    criado_em timestamp default now()
);

-- 4. Solicitações de Orçamento
create table solicitacoes_orcamento (
    id uuid primary key default gen_random_uuid(),
    cliente_id uuid references clientes(id) on delete cascade,
    criado_em timestamp default now()
);

-- 5. Solicitação x Serviços (Muitos-para-Muitos)
create table solicitacao_servicos (
    id uuid primary key default gen_random_uuid(),
    solicitacao_id uuid references solicitacoes_orcamento(id) on delete cascade,
    servico_id uuid references servicos(id) on delete cascade
);

-- 6. Agendamentos de Reuniões
create table agendamentos (
    id uuid primary key default gen_random_uuid(),
    cliente_id uuid references clientes(id) on delete cascade,
    servico_id uuid references servicos(id) on delete set null,
    data date not null,
    horario time not null,
    mensagem text,
    criado_em timestamp default now()
);

-- 7. Pedidos (projetos aprovados)
create table pedidos (
    id uuid primary key default gen_random_uuid(),
    cliente_id uuid references clientes(id) on delete cascade,
    criado_em timestamp default now(),
    atualizado_em timestamp default now()
);

-- 8. Histórico de Status dos Pedidos (Linha do tempo)
create table historico_status (
    id uuid primary key default gen_random_uuid(),
    pedido_id uuid references pedidos(id) on delete cascade,
    status text check (status in ('planejamento', 'processando', 'finalizado')),
    alterado_em timestamp default now()
);

-- ========================================
-- Inserts iniciais
-- ========================================

-- Nichos padrão
insert into nichos (nome) values
('Gastronomia'),
('Comércio'),
('Moda'),
('Educação'),
('Tecnologia'),
('Saúde');

-- Serviços padrão
insert into servicos (nome) values
('Criação de identidade visual'),
('Criação de conteúdo'),
('Gestão de redes sociais'),
('Cobertura em eventos');